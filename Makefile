###############################################################################
# Colors
###############################################################################
GREEN  := \033[0;32m
YELLOW := \033[1;33m
BLUE   := \033[0;34m
NC     := \033[0m

###############################################################################
# Compiler & Flags
###############################################################################
CXX       = g++
CXXFLAGS  = -Wall -Wextra -Werror -O2 -MMD -MP -std=c++17
# -MMD and -MP tell the compiler to generate .d (dependency) files for each .c

###############################################################################
# Project Settings
###############################################################################
SRC_DIR  = srcs
INC_DIR  = inc
OBJ_DIR  = build
LIB_DIR  = $(OBJ_DIR)/lib
TARGET   = $(LIB_DIR)/libftpp.a

###############################################################################
# Sources / Objects
###############################################################################
SRC_FILES := $(shell find $(SRC_DIR) -type f -name '*.cpp')
			
SRCS      := $(SRC_FILES)

OBJS      := $(patsubst $(SRC_DIR)/%.cpp,$(OBJ_DIR)/%.o,$(SRCS))

DEPS      = $(OBJS:.o=.d)

###############################################################################
# Default Rule
###############################################################################
all: $(TARGET)

###############################################################################
# Linking
###############################################################################
$(TARGET): $(OBJS)
	@echo "$(BLUE)Linking $(TARGET)...$(NC)"
	@mkdir -p $(LIB_DIR)
	@ar rc $(TARGET) $(OBJS)
	@echo "$(GREEN)Build complete!$(NC)"

###############################################################################
# Object File Compilation
###############################################################################
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	@echo "$(YELLOW)Compiling $<...$(NC)"
	@mkdir -p $(dir $@)
	@$(CXX) $(CXXFLAGS) -I$(INC_DIR) -c $< -o $@

###############################################################################
# Cleanup
###############################################################################
clean:
	rm -f $(OBJS) $(DEPS)

fclean: clean
	rm -rf $(OBJ_DIR)
	rm -f $(TARGET)

re: fclean all

###############################################################################
# Others Rules
###############################################################################
help:
	@echo "Available targets:"
	@echo "  all      : Build $(TARGET)"
	@echo "  clean    : Remove object files"
	@echo "  fclean   : Remove all generated files"
	@echo "  re       : Rebuild everything"

###############################################################################
# Dependency Handling
###############################################################################
-include $(DEPS)

###############################################################################
# Phony Targets
###############################################################################
.PHONY: all clean fclean re debug help