###############################################################################
# Colors
###############################################################################
GREEN  := \033[0;32m
YELLOW := \033[1;33m
BLUE   := \033[0;34m
NC     := \033[0m

###############################################################################
# Compiler & Flags
###############################################################################
CXX       = c++
CXXFLAGS  = -Wall -Wextra -Werror -O2 -MMD -MP -std=c++17

###############################################################################
# Project Settings
###############################################################################
SRC_DIR  = srcs
INC_DIR  = inc
OBJ_DIR  = build
LIB_DIR  = $(OBJ_DIR)/lib
TARGET   = $(LIB_DIR)/libftpp.a

###############################################################################
# Sources / Objects
###############################################################################
SRC_FILES := $(shell find $(SRC_DIR) -type f -name '*.cpp')
SRCS      := $(SRC_FILES)
OBJS      := $(patsubst $(SRC_DIR)/%.cpp,$(OBJ_DIR)/%.o,$(SRCS))
DEPS      := $(OBJS:.o=.d)

###############################################################################
# Default Rule
###############################################################################
all: $(TARGET)

###############################################################################
# Object File Compilation
###############################################################################
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	@echo "$(YELLOW)Compiling $<...$(NC)"
	@mkdir -p $(dir $@)
	@$(CXX) $(CXXFLAGS) -I$(INC_DIR) -c $< -o $@

###############################################################################
# Linking
###############################################################################
$(TARGET): $(OBJS)
	@echo "$(BLUE)Linking $(TARGET)...$(NC)"
	@mkdir -p $(LIB_DIR)
	@ar rcs $(TARGET) $(OBJS)
	@echo "$(GREEN)Build complete!$(NC)"

###############################################################################
# Cleanup
###############################################################################
clean:
	@rm -rf $(OBJ_DIR)

fclean: clean

re: fclean all

###############################################################################
# Debug
###############################################################################
debug:
	@echo "SRC_FILES: $(SRC_FILES)"
	@echo "SRCS: $(SRCS)"
	@echo "OBJS: $(OBJS)"

###############################################################################
# Dependency Handling
###############################################################################
-include $(DEPS)

###############################################################################
# Phony Targets
###############################################################################
.PHONY: all clean fclean re debug